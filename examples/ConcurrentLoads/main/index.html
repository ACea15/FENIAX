
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for aeroelastic library FENIAX.">
      
      
        <meta name="author" content="Alvaro Cea">
      
      
      
        <link rel="prev" href="../../industrialAC/main/">
      
      
        <link rel="next" href="../../../theory_intrinsic/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Concurrent loads - FENIAX</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bug-model-concurrent-loads-and-uq" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="FENIAX" class="md-header__button md-logo" aria-label="FENIAX" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FENIAX
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Concurrent loads
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ACea15/FENIAX" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ACea15/FENIAX
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../getting_started/" class="md-tabs__link">
        
  
    
  
  Getting started

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../theory_intrinsic/" class="md-tabs__link">
          
  
    
  
  Theoretical background

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../JAX/" class="md-tabs__link">
          
  
    
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../api/inputs/" class="md-tabs__link">
          
  
    
  
  Code base

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="FENIAX" class="md-nav__button md-logo" aria-label="FENIAX" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    FENIAX
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ACea15/FENIAX" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ACea15/FENIAX
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SailPlane/sailplane_nb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sail Plane static response
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wingSP/wingSP_nb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wing nonlinear dynamics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SimoFS/main/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Free flying shell structure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../industrialAC/main/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Full aircraft (clamped) gust verification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Concurrent loads
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Concurrent loads
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#load-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Load modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    <span class="md-ellipsis">
      Imports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Helper functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    <span class="md-ellipsis">
      Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#montecarlo-uq" class="md-nav__link">
    <span class="md-ellipsis">
      Montecarlo UQ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#derivative-of-expectations" class="md-nav__link">
    <span class="md-ellipsis">
      Derivative of expectations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manoeuvre" class="md-nav__link">
    <span class="md-ellipsis">
      Manoeuvre
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-load-envelopes" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic-load envelopes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gust-ad-forager" class="md-nav__link">
    <span class="md-ellipsis">
      Gust AD forager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    <span class="md-ellipsis">
      Run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    <span class="md-ellipsis">
      Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uncertainty-quantification-in-nonlinear-simulations" class="md-nav__link">
    <span class="md-ellipsis">
      Uncertainty quantification in nonlinear simulations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-derivatives-of-expectations" class="md-nav__link">
    <span class="md-ellipsis">
      Computing derivatives of expectations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steady-manoeuvre-loads" class="md-nav__link">
    <span class="md-ellipsis">
      Steady manoeuvre loads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-loads-at-large-scale" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic loads at large scale
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Theoretical background
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Theoretical background
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../theory_intrinsic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intrinsic modal description
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../JAX/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JAX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UML/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UML description
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../inputs.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Program inputs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code base
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Code base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/inputs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inputs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/modes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/couplings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nonlinear couplings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#load-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Load modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    <span class="md-ellipsis">
      Imports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Helper functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    <span class="md-ellipsis">
      Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#montecarlo-uq" class="md-nav__link">
    <span class="md-ellipsis">
      Montecarlo UQ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#derivative-of-expectations" class="md-nav__link">
    <span class="md-ellipsis">
      Derivative of expectations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manoeuvre" class="md-nav__link">
    <span class="md-ellipsis">
      Manoeuvre
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-load-envelopes" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic-load envelopes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gust-ad-forager" class="md-nav__link">
    <span class="md-ellipsis">
      Gust AD forager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    <span class="md-ellipsis">
      Run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    <span class="md-ellipsis">
      Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uncertainty-quantification-in-nonlinear-simulations" class="md-nav__link">
    <span class="md-ellipsis">
      Uncertainty quantification in nonlinear simulations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-derivatives-of-expectations" class="md-nav__link">
    <span class="md-ellipsis">
      Computing derivatives of expectations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steady-manoeuvre-loads" class="md-nav__link">
    <span class="md-ellipsis">
      Steady manoeuvre loads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-loads-at-large-scale" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic loads at large scale
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="bug-model-concurrent-loads-and-uq">BUG model: concurrent loads and UQ<a class="headerlink" href="#bug-model-concurrent-loads-and-uq" title="Permanent link">造</a></h1>
<h2 id="load-modules">Load modules<a class="headerlink" href="#load-modules" title="Permanent link">造</a></h2>
<h3 id="imports">Imports<a class="headerlink" href="#imports" title="Permanent link">造</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="n">REMOVE_RESULTS</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1">#   for root, dirs, files in os.walk(&#39;/path/to/folder&#39;):</span>
<span class="c1">#       for f in files:</span>
<span class="c1">#           os.unlink(os.path.join(root, f))</span>
<span class="c1">#       for d in dirs:</span>
<span class="c1">#           shutil.rmtree(os.path.join(root, d))</span>
<span class="c1"># </span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;results&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s2">&quot;./figs&quot;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;./figs&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">REMOVE_RESULTS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s2">&quot;./results&quot;</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s2">&quot;./results&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s2">&quot;./results&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;***** creating results folder ******&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;./results&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;./results&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">feniax.plotools.uplotly</span> <span class="k">as</span> <span class="nn">uplotly</span>
<span class="kn">import</span> <span class="nn">feniax.preprocessor.solution</span> <span class="k">as</span> <span class="nn">solution</span>
<span class="kn">import</span> <span class="nn">feniax.preprocessor.configuration</span> <span class="k">as</span> <span class="nn">configuration</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
</code></pre></div>
<h3 id="helper-functions">Helper functions<a class="headerlink" href="#helper-functions" title="Permanent link">造</a></h3>
<ol>
<li>
<p>Common functions</p>
<div class="highlight"><pre><span></span><code><span class="n">scale_quality</span> <span class="o">=</span> <span class="mi">6</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Format for figures: </span><span class="si">{</span><span class="n">figfmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image quality: </span><span class="si">{</span><span class="n">scale_quality</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  
<span class="k">def</span> <span class="nf">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">figformat</span><span class="o">=</span><span class="n">figfmt</span><span class="p">,</span> <span class="n">update_layout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inner_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">update_layout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="o">**</span><span class="n">update_layout</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;figs/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">figformat</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../</span><span class="si">{</span><span class="n">figname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale_quality</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">figname</span>
        <span class="k">return</span> <span class="n">inner</span>
    <span class="k">return</span> <span class="n">inner_decorator</span>

<span class="k">def</span> <span class="nf">fig_background</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># if fig.data[0].showlegend is None:</span>
        <span class="c1">#     showlegend = True</span>
        <span class="c1"># else:</span>
        <span class="c1">#     showlegend = fig.data[0].showlegend</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
                       <span class="c1">#titlefont=dict(size=20),</span>
                       <span class="n">tickfont</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
                       <span class="n">mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">ticks</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span>
                       <span class="n">showline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="c1">#zeroline=True,</span>
        <span class="c1">#zerolinewidth=2,</span>
            <span class="c1">#zerolinecolor=&#39;LightPink&#39;,</span>
                       <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">tickfont</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
                       <span class="c1">#titlefont=dict(size=20),</span>
                       <span class="n">zeroline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">ticks</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span>
                       <span class="n">showline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                       <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">plot_bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                          <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">zerolinecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">),</span>
                          <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                              <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span>
                              <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
                          <span class="p">),</span>
                          <span class="c1">#showlegend=True, #showlegend,</span>
                          <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                              <span class="n">autoexpand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                              <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                              <span class="n">t</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">b</span><span class="o">=</span><span class="mi">0</span>
                          <span class="p">))</span>
        <span class="k">return</span> <span class="n">fig</span>
    <span class="k">return</span> <span class="n">inner</span>

<span class="c1"># fig.update_layout(</span>
<span class="c1">#     xaxis=dict(</span>
<span class="c1">#         title=&#39;X AxisTitle&#39;,</span>
<span class="c1">#         title_font=dict(family=&#39;Arial Black&#39;, size=22, color=&#39;black&#39;),</span>
<span class="c1">#         tickfont=dict(family=&#39;Arial&#39;, size=18, color=&#39;black&#39;)</span>
<span class="c1">#     ),</span>
<span class="c1">#     yaxis=dict(</span>
<span class="c1">#         title=&#39;Y Axis Title&#39;,</span>
<span class="c1">#         title_font=dict(family=&#39;Arial Black&#39;, size=22, color=&#39;black&#39;),</span>
<span class="c1">#         tickfont=dict(family=&#39;Arial&#39;, size=18, color=&#39;black&#39;)</span>
<span class="c1">#     ),</span>
<span class="c1">#     font=dict(</span>
<span class="c1">#         family=&quot;Arial&quot;,</span>
<span class="c1">#         size=18,</span>
<span class="c1">#         color=&quot;black&quot;</span>
<span class="c1">#     ),</span>
<span class="c1">#     legend=dict(</span>
<span class="c1">#         font=dict(size=16),</span>
<span class="c1">#         x=0.02,</span>
<span class="c1">#         y=0.98,</span>
<span class="c1">#         bgcolor=&#39;rgba(255,255,255,0)&#39;,  # transparent background</span>
<span class="c1">#         bordercolor=&#39;black&#39;,</span>
<span class="c1">#         borderwidth=1</span>
<span class="c1">#     ),</span>
<span class="c1">#     margin=dict(l=80, r=40, t=40, b=80),</span>
<span class="c1">#     width=700,</span>
<span class="c1">#     height=500</span>
<span class="c1"># )</span>
</code></pre></div>
</li>
<li>
<p>Plot functions</p>
<div class="highlight"><pre><span></span><code><span class="nd">@fig_background</span>
<span class="k">def</span> <span class="nf">plot_wingmeanstd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ystd</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span>
        <span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">specs</span><span class="o">=</span><span class="p">[[{},</span> <span class="p">{</span><span class="s2">&quot;rowspan&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}],</span>  <span class="c1"># Row 1: col1 has plot, col2 is Plot C spanning 2 rows</span>
               <span class="p">[{}</span> <span class="p">,</span> <span class="kc">None</span><span class="p">]],</span>          <span class="c1"># Row 2: col1 has plot, col2 empty due to rowspan</span>
        <span class="c1">#subplot_titles=(&quot;Plot A&quot;, &quot;Plot C&quot;, &quot;Plot B&quot;)  # Adjust titles as needed</span>
    <span class="p">)</span>

    <span class="n">fig1</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mu_u$&#39;</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(31, 119, 180)&#39;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="c1">#name=r&#39;$\pm 1 \sigma$&#39;,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ystd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444&quot;</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">),</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\pm 1 \sigma_u$&#39;</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ystd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444&quot;</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;rgba(68, 68, 68, 0.3)&#39;</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tonexty&#39;</span><span class="p">,</span>
            <span class="c1">#showlegend=False</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">fig2</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="c1">#name=r&#39;$\mu_u$&#39;,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(31, 119, 180)&#39;</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">),</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="c1">#name=r&#39;$\pm 1 \sigma$&#39;,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ystd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444&quot;</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">),</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="c1">#name=r&#39;$\pm 1 \sigma_u$&#39;,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ystd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444&quot;</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;rgba(68, 68, 68, 0.3)&#39;</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tonexty&#39;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">fig3</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="c1">#name=r&#39;$\mu_u$&#39;,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(31, 119, 180)&#39;</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">),</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="c1">#name=r&#39;$\pm 1 \sigma$&#39;,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">ystd</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444&quot;</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">),</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="c1">#name=r&#39;$\pm 1 \sigma_u$&#39;,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ystd</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444&quot;</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;rgba(68, 68, 68, 0.3)&#39;</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tonexty&#39;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Plot A (bottom-left)</span>
    <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">fig1</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">fi</span><span class="p">,</span>
            <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

    <span class="c1"># Plot B (bottom-left)</span>
    <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">fig2</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">fi</span><span class="p">,</span>
            <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

    <span class="c1"># Plot C (bottom-left)</span>
    <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">fig3</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">fi</span><span class="p">,</span>
            <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
    <span class="c1">#fig.update_xaxes(title_text=&quot;Wing span&quot;, row=1, col=1)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$ \large u_x \; [m]$&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Wing span&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;$ \large u_y \; [m]$&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Wing span&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;$ \large u_z \; [m]$&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">),</span>
        <span class="c1"># xaxis_title=&quot;Wing span [m]&quot;,</span>
        <span class="c1"># yaxis_title=&#39;Wing vertical displacement [m]&#39;,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@fig_background</span>
<span class="k">def</span> <span class="nf">plot_jacpdiff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yobj</span><span class="p">,</span> <span class="n">yjac</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">uplotly</span><span class="o">.</span><span class="n">lines2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yobj</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span>
                          <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Objective&quot;</span><span class="p">,</span>
                               <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                               <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span>
                               <span class="p">),</span>
                          <span class="nb">dict</span><span class="p">())</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">uplotly</span><span class="o">.</span><span class="n">lines2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yjac</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span>
                          <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Jacobian&quot;</span><span class="p">,</span>
                               <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span>
                               <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;square&quot;</span><span class="p">)</span>
                               <span class="p">),</span>
                          <span class="nb">dict</span><span class="p">())</span>

    <span class="n">powersx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">powersy</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">tickvalsx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span> <span class="o">**</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">powersx</span><span class="p">]</span>
    <span class="n">tickvalsy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span> <span class="o">**</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">powersy</span><span class="p">]</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
                     <span class="c1">#tickformat= &#39;.0e&#39;,</span>
                     <span class="c1">#showexponent = &#39;first&#39;,</span>
                     <span class="c1">#tickvals=tickvalsx,</span>
                     <span class="c1">#ticktext=[f&quot;10^{p}&quot; for p in powersx],</span>
                     <span class="n">exponentformat</span> <span class="o">=</span> <span class="s1">&#39;power&#39;</span>
                     <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
                     <span class="c1">#tickformat= &#39;.0e&#39;</span>
                     <span class="c1">#tickvals=tickvalsy,</span>
                     <span class="c1">#showgrid=True,         # Keep all grid lines</span>
                     <span class="c1">#minor=dict(</span>
                     <span class="c1">#    showgrid=True      # THIS enables minor grid lines</span>
                     <span class="c1">#),</span>
                     <span class="c1">#ticktext=[f&quot;10^{p}&quot; for p in powersy],                      </span>
                     <span class="n">exponentformat</span> <span class="o">=</span> <span class="s1">&#39;power&#39;</span>
                     <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">),</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Number of paths&quot;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Relative Error&#39;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@fig_background</span>
<span class="k">def</span> <span class="nf">plot_jacediff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yjac</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">uplotly</span><span class="o">.</span><span class="n">lines2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yjac</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span>
                          <span class="nb">dict</span><span class="p">(</span><span class="c1">#name=&quot;Jacobian&quot;,</span>
                               <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span>
                               <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;square&quot;</span><span class="p">)</span>
                               <span class="p">),</span>
                          <span class="nb">dict</span><span class="p">())</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
                     <span class="c1">#tickformat= &#39;.0e&#39;</span>
                     <span class="n">exponentformat</span> <span class="o">=</span> <span class="s1">&#39;power&#39;</span>
                     <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
                     <span class="c1">#tickformat= &#39;.0e&#39;</span>
                     <span class="n">exponentformat</span> <span class="o">=</span> <span class="s1">&#39;power&#39;</span>
                     <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\text{Finite-Differences } \Large \epsilon$&#39;</span><span class="p">,</span>
                      <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Relative Error&quot;</span><span class="p">)</span>
    <span class="c1">#fig.update_layout(xaxis_type=&quot;log&quot;, yaxis_type=&quot;log&quot;)</span>
    <span class="k">return</span> <span class="n">fig</span>


<span class="k">def</span> <span class="nf">plot_jacpdiff2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">yobj</span><span class="p">,</span> <span class="n">yjac</span><span class="p">,</span> <span class="n">figformat</span><span class="o">=</span><span class="n">figfmt</span><span class="p">):</span>

    <span class="c1"># Create figure and axes</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">))</span>  <span class="c1"># width=8 inches, height=6 inches</span>

    <span class="c1"># Plot the data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yobj</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Objective&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>          <span class="c1"># Circle markers</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yjac</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jacobian&#39;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> 
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="c1"># Set logarithmic scale</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>  <span class="c1"># Set x-axis to log scale</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>  <span class="c1"># Optional, y-axis remains linear</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>      
    <span class="c1"># Add labels and title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of paths&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Relative error&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Add grid and legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="c1"># Automatically adjust layout to prevent clipping</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="n">figname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;figs/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">figformat</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../</span><span class="si">{</span><span class="n">figname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>  

    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">figname</span>

<span class="k">def</span> <span class="nf">plot_jacediff2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">yjac</span><span class="p">,</span> <span class="n">figformat</span><span class="o">=</span><span class="n">figfmt</span><span class="p">):</span>

    <span class="c1"># Create figure and axes</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">))</span>  <span class="c1"># width=8 inches, height=6 inches</span>

    <span class="c1"># Plot the data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yjac</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>          <span class="c1"># Circle markers              </span>
            <span class="c1">#label=&#39;y = log10(x)&#39;,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="c1"># Set logarithmic scale</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>  <span class="c1"># Set x-axis to log scale</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>  <span class="c1"># Optional, y-axis remains linear</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="c1"># Add labels and title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\text{Finite-Differences } \epsilon$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Error&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Add grid and legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="c1">#ax.legend()</span>
    <span class="c1"># Automatically adjust layout to prevent clipping</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="n">figname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;figs/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">figformat</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Save plot to file</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../</span><span class="si">{</span><span class="n">figname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>  

    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">figname</span>

<span class="nd">@fig_background</span>
<span class="k">def</span> <span class="nf">plot_jacfemold</span><span class="p">(</span><span class="n">jac</span><span class="p">,</span> <span class="n">xindex</span><span class="p">,</span> <span class="n">yindex</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
        <span class="n">z</span><span class="o">=</span><span class="n">jac</span><span class="p">[</span><span class="n">xindex</span><span class="p">[:,</span><span class="kc">None</span><span class="p">],</span> <span class="n">yindex</span><span class="p">],</span> <span class="n">colorscale</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span><span class="p">))</span>
    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
      <span class="n">tickmode</span> <span class="o">=</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
      <span class="n">tickvals</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xindex</span><span class="p">)),</span>
      <span class="n">ticktext</span> <span class="o">=</span> <span class="n">xindex</span>
    <span class="p">)</span>
    <span class="n">yaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
      <span class="n">tickmode</span> <span class="o">=</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
      <span class="n">tickvals</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yindex</span><span class="p">)),</span>
      <span class="n">ticktext</span> <span class="o">=</span> <span class="n">yindex</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span>
                      <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                      <span class="n">xaxis_title</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                      <span class="n">yaxis_title</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="c1">#fig.update_layout(xaxis_type=&quot;log&quot;, yaxis_type=&quot;log&quot;)</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@fig_background</span>
<span class="k">def</span> <span class="nf">plot_jacfem</span><span class="p">(</span><span class="n">jac</span><span class="p">,</span> <span class="n">jac2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;j&quot;</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>

    <span class="c1"># fig = go.Figure(data=go.Heatmap(</span>
    <span class="c1">#     z=jac, colorscale = &#39;hot&#39;))</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;reds&#39;</span><span class="p">),</span>
        <span class="c1">#go.Surface(z=jac2, showscale=False, opacity=0.9, colorscale=&#39;reds&#39;),</span>
        <span class="c1">#go.Surface(z=jac-1, showscale=False, opacity=0.9)</span>

    <span class="p">])</span>      
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_title</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                      <span class="n">yaxis_title</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                      <span class="c1">#zaxis_title=&quot;dd&quot;</span>
                      <span class="n">scene</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                          <span class="n">xaxis_title</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                          <span class="n">yaxis_title</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                          <span class="n">zaxis_title</span><span class="o">=</span><span class="n">zlabel</span><span class="p">,</span>
                          <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                              <span class="n">backgroundcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0, 0, 0,0)&quot;</span><span class="p">,</span>
                              <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                              <span class="n">showbackground</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">zerolinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,),</span>
                          <span class="n">yaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                              <span class="n">backgroundcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0, 0, 0,0)&quot;</span><span class="p">,</span>
                              <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                              <span class="n">showbackground</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">zerolinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                          <span class="n">zaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                              <span class="n">backgroundcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0, 0, 0,0)&quot;</span><span class="p">,</span>
                              <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                              <span class="n">showbackground</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">zerolinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,),</span>
                      <span class="p">),</span>
                      <span class="p">)</span>
    <span class="c1">#fig.update_layout(xaxis_type=&quot;log&quot;, yaxis_type=&quot;log&quot;)</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@fig_background</span>
<span class="k">def</span> <span class="nf">plot_manoeuvretip</span><span class="p">(</span><span class="n">aoa</span><span class="p">,</span> <span class="n">ua</span><span class="p">,</span> <span class="n">ua_lin</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">]</span>
    <span class="n">dashes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;dash&quot;</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">uplotly</span><span class="o">.</span><span class="n">lines2d</span><span class="p">(</span><span class="n">aoa</span><span class="p">,</span> <span class="n">ua</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Nonlinear&quot;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">dash</span><span class="o">=</span><span class="n">dashes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">))</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">uplotly</span><span class="o">.</span><span class="n">lines2d</span><span class="p">(</span><span class="n">aoa</span><span class="p">,</span> <span class="n">ua_lin</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Linear&quot;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">dash</span><span class="o">=</span><span class="n">dashes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\large \hat</span><span class="si">{u}</span><span class="s1">_z [\%]$&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="c1">#range=aoa,</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$AoA [^o]$&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@fig_background</span>
<span class="k">def</span> <span class="nf">plot_gustshard</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span>
                    <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span>
                        <span class="n">z</span><span class="o">=</span> <span class="n">z</span><span class="p">[:,:,</span> <span class="n">component</span><span class="p">],</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="c1"># horizontal axis</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="c1"># vertical axis</span>
                        <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                        <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                            <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                        <span class="p">)</span>  <span class="c1"># Set tick font size</span>
                    <span class="p">)</span>
                    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Gust length [m]&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Gust intensity [m/s]&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@fig_background</span>
<span class="k">def</span> <span class="nf">plot_jacfem2</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span>
                    <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span>
                        <span class="n">z</span><span class="o">=</span> <span class="n">z</span><span class="p">,</span>
                        <span class="c1">#x=x, # horizontal axis</span>
                        <span class="c1">#y=y, # vertical axis</span>
                        <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;blues&#39;</span><span class="p">,</span>
                        <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                            <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                        <span class="p">)</span>  <span class="c1"># Set tick font size</span>
                    <span class="p">)</span>
                    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div>
</li>
</ol>
<h2 id="models">Models<a class="headerlink" href="#models" title="Permanent link">造</a></h2>
<p>For a complete walk-through of model and creation see the file
<a href="../../../examples/BUG/modelgeneration.org">modelgeneration.org</a></p>
<h3 id="montecarlo-uq">Montecarlo UQ<a class="headerlink" href="#montecarlo-uq" title="Permanent link">造</a></h3>
<ul>
<li>Discrete loading field along wings with uncertainty component
    (Gaussian)</li>
<li>Python file: settings~DiscreteMC1high~.py,
    settings~DiscreteMC1MCsmall~.py, settings~DiscreteMC1vsmall~.py</li>
<li>Results presented in Sec.
    <a href="#Uncertainty quantification in nonlinear simulations">1.3.1</a></li>
</ul>
<h3 id="derivative-of-expectations">Derivative of expectations<a class="headerlink" href="#derivative-of-expectations" title="Permanent link">造</a></h3>
<ul>
<li>Compute derivatives of the expectations previously computed
    concurrently via Montecarlo simulations.</li>
<li>Python file: settings~ADDiscreteMC1t~.py,
    settings~ADDiscreteMC1tfdjac~.py, settings~ADDiscreteMC1fem~.py</li>
<li>Results presented in Sec.
    <a href="#Computing derivatives of expectations">1.3.2</a></li>
<li>Corresponding test:
    <a href="../../../tests/intrinsic/montecarlo/test_BUGUQ.py">../../../tests/intrinsic/montecarlo/test_BUGUQ.py</a></li>
</ul>
<h3 id="manoeuvre">Manoeuvre<a class="headerlink" href="#manoeuvre" title="Permanent link">造</a></h3>
<ul>
<li>Manoeuvre case with clamped AC varying u~inf~ and rho~inf~</li>
<li>Testing and benchmarking parallelisation</li>
<li>Python file: settings~manoeuvre1shard~.py for computations</li>
<li>Results presented in Sec. <a href="#Steady manoeuvre loads">1.3.3</a></li>
<li>Corresponding test:
    <a href="../../../tests/intrinsic/aeroelastic_static/test_BUGmanoeuvre.py">../../../tests/intrinsic/aeroelastic_static/test_BUGmanoeuvre.py</a></li>
</ul>
<h3 id="dynamic-load-envelopes">Dynamic-load envelopes<a class="headerlink" href="#dynamic-load-envelopes" title="Permanent link">造</a></h3>
<ul>
<li>Construct gusts of different lengths, intensity and airflow density</li>
<li>Python file: python settings~gust1shard~.py for plotting (11x11=121
    gust) settings~gust1shardbench~.py for benchmark (8x8x8=256 gust)</li>
<li>Results presented in Sec. <a href="#Dynamic loads at large scale">1.3.4</a></li>
<li>Corresponding test:
    <a href="../../../tests/intrinsic/aeroelastic_dynamic/test_BUGgustShard.py">../../../tests/intrinsic/aeroelastic_dynamic/test_BUGgustShard.py</a></li>
</ul>
<h3 id="gust-ad-forager">Gust AD forager<a class="headerlink" href="#gust-ad-forager" title="Permanent link">造</a></h3>
<ul>
<li>Run gusts in parallel and find the worst cases</li>
<li>Checking AD of free-flying AC for worst case determined by forager</li>
<li>Python file: settings~gustforager~.py</li>
<li>Results presented in Sec. <a href="#Load envelope differentiation">1.3.4.1</a></li>
<li>Corresponding test:
    <a href="../../../tests/intrinsic/aeroelastic_dynamic/test_BUGforager.py">../../../tests/intrinsic/aeroelastic_dynamic/test_BUGforager.py</a></li>
</ul>
<h3 id="run">Run<a class="headerlink" href="#run" title="Permanent link">造</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">Manoeuvre</span><span class="o">=</span><span class="s2">&quot;tru&quot;</span>
<span class="nv">Montecarlo</span><span class="o">=</span><span class="s2">&quot;tru&quot;</span>
<span class="nv">MontecarloADt</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
<span class="nv">MontecarloADtjac</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
<span class="nv">MontecarloADtfd</span><span class="o">=</span><span class="s2">&quot;tru&quot;</span><span class="w">    </span>
<span class="nv">MontecarloADfem</span><span class="o">=</span><span class="s2">&quot;tru&quot;</span>
<span class="nv">Gust</span><span class="o">=</span><span class="s2">&quot;tru&quot;</span>
<span class="nv">GustBench</span><span class="o">=</span><span class="s2">&quot;tru&quot;</span>
<span class="nv">Forager</span><span class="o">=</span><span class="s2">&quot;tru&quot;</span>

pyenv<span class="w"> </span>activate<span class="w"> </span>feniax
<span class="nv">pathBUG</span><span class="o">=</span><span class="s2">&quot;../../../../FENIAXexamples/BUG/&quot;</span>
<span class="nv">current_dir</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$pathBUG</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$Manoeuvre</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RUNNING MANOEUVRE&quot;</span>
<span class="w">    </span>python<span class="w"> </span>settings_manoeuvre1shard.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$Montecarlo</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RUNNING MONTECARLO&quot;</span>
<span class="w">    </span>python<span class="w"> </span>settings_DiscreteMC1high.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="w">    </span>python<span class="w"> </span>settings_DiscreteMC1small.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="w">    </span>python<span class="w"> </span>settings_DiscreteMC1vsmall.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$MontecarloADt</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RUNNING MONTECARLOADT&quot;</span>
<span class="w">    </span><span class="c1"># python settings_ADDiscreteLoadsMC_validation.py $current_dir</span>
<span class="w">    </span>python<span class="w"> </span>settings_ADDiscreteMC1_t.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$MontecarloADtjac</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RUNNING MONTECARLOADTJAC&quot;</span>
<span class="w">    </span><span class="c1"># python settings_ADDiscreteLoadsMC_validation.py $current_dir</span>
<span class="w">    </span>python<span class="w"> </span>settings_ADDiscreteMC1_t_fdjac.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$MontecarloADtfd</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RUNNING MONTECARLOADTFD&quot;</span>
<span class="w">    </span><span class="c1"># python settings_ADDiscreteLoadsMC_validation.py $current_dir</span>
<span class="w">    </span>python<span class="w"> </span>settings_ADDiscreteMC1_t_fd.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$MontecarloADfem</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RUNNING MONTECARLOADFEM&quot;</span>
<span class="w">    </span>python<span class="w"> </span>settings_ADDiscreteMC1_fem.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="w">    </span><span class="c1">#python settings_ADDiscreteLoadsMC.py $current_dir</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$Gust</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RUNNING GUST&quot;</span>
<span class="w">    </span>python<span class="w"> </span>settings_gust1shard.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$GustBench</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RUNNING GUST BENCHMARK&quot;</span>
<span class="w">    </span>python<span class="w"> </span>settings_gust1shardbench.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="k">fi</span><span class="w">  </span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$Forager</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RUNNING FORAGER&quot;</span>
<span class="w">    </span>python<span class="w"> </span>settings_gustforager.py<span class="w"> </span><span class="nv">$current_dir</span>
<span class="k">fi</span>
</code></pre></div>
<h2 id="results">Results<a class="headerlink" href="#results" title="Permanent link">造</a></h2>
<p>In this section we show the main strengths of our solvers. We run a
representative aircraft model undergoing very large nonlinear
displacements, the University of Bristol Ultra-Green (BUG) aircraft
model <a href="cite:&amp;STODIECK2018">cite:&amp;STODIECK2018</a> is the chosen platform as
it is not based on proprietary data and it showcases high-aspect ratio
wings and a GFEM based on beam and shell elements in MSC Nastran. The
main components of the aeroelastic model have been presented in
<a href="cite:&amp;CEA2025a">cite:&amp;CEA2025a</a>. Leveraging on modern hardware
architectures and a parallelisation across devices, to unlock problems
such as quantifying the uncertainties in the nonlinear response given a
non-deterministic loading field. We build load envelopes of static and
dynamic aeroelastic simulations and differentiate across the concurrent
simulations to obtain sensitivities of dynamic loads as well as moment
statistics.<br />
Structural and aeroelastic static simulations follow, solved via a
Newton-Raphson solver with tolerance of $10^{-6}$, as well as an
assessment of the aircraft dynamics in response to various gust
profiles. A high modal resolution of 100 modes is employed in all the
results, more than what is necessary for most of the examples.
Calculations are carried out on a CPU Intel Xeon Silver 4108 with
1.80GHz speed, 6 cores and a total 12 threads, as well as on an Nvidia
GPU A100 80GB SXM.</p>
<h3 id="uncertainty-quantification-in-nonlinear-simulations">Uncertainty quantification in nonlinear simulations<a class="headerlink" href="#uncertainty-quantification-in-nonlinear-simulations" title="Permanent link">造</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># using jac_ediff2 that was computed in memory instead of loading the result which seems to loose accuracy</span>
<span class="n">READ_CONFIG</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="s1">&#39;config_mc1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
    <span class="n">config_mc1</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;./DiscreteMC1high/config.yaml&quot;</span><span class="p">)</span>
<span class="n">sol_mc1high</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./DiscreteMC1high&quot;</span><span class="p">)</span>
<span class="n">sol_mc1small</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./DiscreteMC1small&quot;</span><span class="p">)</span>
<span class="n">sol_mc1vsmall</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./DiscreteMC1vsmall&quot;</span><span class="p">)</span>
<span class="n">wing_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">36</span><span class="p">))</span>
<span class="n">wing_span</span> <span class="o">=</span> <span class="n">config_mc1</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">wing_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">wing_nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">Utipmean</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Utipsmallmean</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Utipvsmallmean</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Utipstd</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Utipsmallstd</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Utipvsmallstd</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Umean_wing</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Ustd_wing</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
    <span class="n">u_tipmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sol_mc1high</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">ra</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">component</span><span class="p">,</span><span class="mi">35</span><span class="p">]</span> <span class="o">-</span> <span class="n">config_mc1</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span><span class="n">component</span><span class="p">])</span>
    <span class="n">u_tipstd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sol_mc1high</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">ra</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">component</span><span class="p">,</span><span class="mi">35</span><span class="p">])</span>
    <span class="n">u_tipsmallmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sol_mc1small</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">ra</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">component</span><span class="p">,</span><span class="mi">35</span><span class="p">]</span> <span class="o">-</span> <span class="n">config_mc1</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span><span class="n">component</span><span class="p">])</span>
    <span class="n">u_tipsmallstd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sol_mc1small</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">ra</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">component</span><span class="p">,</span><span class="mi">35</span><span class="p">])</span>
    <span class="n">u_tipvsmallmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sol_mc1vsmall</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">ra</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">component</span><span class="p">,</span><span class="mi">35</span><span class="p">]</span> <span class="o">-</span> <span class="n">config_mc1</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span><span class="n">component</span><span class="p">])</span>
    <span class="n">u_tipvsmallstd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sol_mc1vsmall</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">ra</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">component</span><span class="p">,</span><span class="mi">35</span><span class="p">])</span>
    <span class="n">Utipmean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_tipmean</span><span class="p">)</span>
    <span class="n">Utipsmallmean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_tipsmallmean</span><span class="p">)</span>
    <span class="n">Utipvsmallmean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_tipvsmallmean</span><span class="p">)</span>    
    <span class="n">Utipstd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_tipstd</span><span class="p">)</span>
    <span class="n">Utipsmallstd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_tipsmallstd</span><span class="p">)</span>
    <span class="n">Utipvsmallstd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_tipvsmallstd</span><span class="p">)</span>

    <span class="n">umean_wing</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ustd_wing</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ni</span> <span class="ow">in</span> <span class="n">wing_nodes</span><span class="p">:</span>
        <span class="n">umean_wing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sol_mc1high</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">ra</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">ni</span><span class="p">]</span> <span class="o">-</span>
                          <span class="n">config_mc1</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">ni</span><span class="p">,</span><span class="n">component</span><span class="p">]))</span>
        <span class="n">ustd_wing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sol_mc1high</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">ra</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">ni</span><span class="p">]</span> <span class="o">-</span>
                          <span class="n">config_mc1</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">ni</span><span class="p">,</span><span class="n">component</span><span class="p">]))</span>
    <span class="n">umean_wing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">umean_wing</span><span class="p">)</span>
    <span class="n">ustd_wing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ustd_wing</span><span class="p">)</span>
    <span class="n">Umean_wing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">umean_wing</span><span class="p">)</span>
    <span class="n">Ustd_wing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ustd_wing</span><span class="p">)</span>
</code></pre></div>
<p>In this section uncertainty quantification is performed for both linear
and nonlinear responses to a loading field that is non-deterministic.
Thousands of simulations are employed in Monte Carlo type of analysis to
resolve for the statistics, for which parallelisation of the independent
simulations become critical. The example resembles the workflow of
flight loads and wing stress analysis in an industrial setup. There will
always be an element of uncertainty around computed loads, and what we
show here is how for large displacements, the statistics need to be
computed for every distinct loading. And for this, having a
parallisation strategy as the one presented could potentially allow the
computation of complex correlations and averages via Montecarlo
analysis.<br />
Considering this, a static loading field is prescribed along the wings
consisting of follower forces in the normal (out-of-plane) direction, as
well as torsional moments (to mimic the added aerodynamic forces on an
airfoil), with the characteristic that the force follows a normal
distribution:</p>
<p><div class="highlight"><pre><span></span><code>\begin{subequations}

$$\begin{align}\label{eq:normal_loading}
N&amp;(\mu=1.5 \times 10^4 \mu_0, \sigma=0.15 \mu) \; \text{[forces]}  \\
N&amp;(\mu=3 \times 10^4 \mu_0, \sigma=0.15 \mu)   \; \text{[moments]}
\end{align}$$
\end{subequations}
</code></pre></div>
Three scenarios are studied: one in which very large nonlinear
deformations are induced with $\mu_0 = 1$, and two small loading with
$\mu_0 = 10^{-2}$ and $\mu_0 = 10^{-3}$. The distribution of
displacements is characterised by means of Montecarlo simulations that
run in parallel for a total of 1600 simulations. Fig. <a href="#fig:BUG_mc">1</a>
shows the equilibrium at high loading ($\mu_0 = 1$) for two of the
random cases (first and last of the 1600 computed).</p>
<p><img alt="Static equilibrium for two cases of the random excitation
($\mu_0=1$)" src="../figs_ext/MC1.png" title="BUG_mc" /></p>
<p>Table <a href="#table:BUG_mc">1</a> shows the normalized statistics gathered from
the response, in this case the expectation of tip of the wing
displacements in the normal (out-of-plane) direction, $\mu_u $, and the
corresponding standard deviation, $ \sigma_u  $.</p>
<div id="table:BUG_mc">
<table>
<thead>
<tr>
<th>Case</th>
<th>$\mu_u / \mu_0 $</th>
<th>$ \sigma_u / \mu_0 $</th>
</tr>
</thead>
<tbody>
<tr>
<td>($\mu_0 = 1$)</td>
<td>11.57</td>
<td>1.35</td>
</tr>
<tr>
<td>($\mu_0 = 0.01$)</td>
<td>14.8</td>
<td>2.4</td>
</tr>
<tr>
<td>($\mu_0 = 0.001$)</td>
<td>14.9</td>
<td>2.3</td>
</tr>
</tbody>
</table>
</div>
<p>We can see the statistics of the linear response ($\mu_0 = 0.001$) are
fully captured by one single Montecarlo analysis, that is, output
magnitudes such as equilibrium displacements correlate with the average
input load. Whereas in cases with nonlinear deformations ($\mu_0 = 1$),
the whole Montecarlo analysis would need to be carried out. This is akin
to deterministic linear versus nonlinear analysis. Expanding this data
at the tip to the entire right wing, Fig. <a href="#fig:wing_meanstd">2</a> shows
the mean normal displacement along the wing, $\mu_u$, and its standard
deviation, $\sigma_u$. Note how despite the standard deviation of the
input forces is the same along the wing, the uncertainty in the
displacement output grows towards the tip as expected the aircraft
being clamped at the root will only showcase 0 displacements there
regardless of the input forces.</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="n">plot_wingmeanstd</span><span class="p">)(</span><span class="n">wing_span</span><span class="p">,</span> <span class="n">Umean_wing</span><span class="p">,</span> <span class="n">Ustd_wing</span><span class="p">)</span>
<span class="n">figname</span>
</code></pre></div>
<p><img alt="Wing vertical displacements expectations and 1
standard-deviation" src="../figs/wing_meanstd.png" title="wing_meanstd" /></p>
<p>Table <a href="#table:times_MC">2</a> shows the times taken for the nonlinear case
in both CPU and GPU. The computation of 1600 independent simulations in
just over a minute, involving deformations of over 40% the wing
semi-span as shown in Fig. <a href="#fig:BUG_mc">1</a>, highlights the potential of
this methodology in more complex uncertainty quantification problems.
Note that at this level of nonlinearity, our solvers are already two
orders of magnitude faster than commercial solvers such as MSC Nastran
even for a single simulation as demonstrated in
<a href="cite:&amp;CEA2025">cite:&amp;CEA2025</a>. The extension to thousands of cases with
parallelisation on modern architectures is a key feature of this work
with far-reaching applications in aircraft loads analysis.</p>
<div id="table:times_MC">
<table>
<thead>
<tr>
<th>Device</th>
<th>Time <script type="math/tex; mode=display">sec.</script>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>CPU (single)</td>
<td>16.8  1600 = 26880</td>
</tr>
<tr>
<td>CPU (parallel)</td>
<td>317.4</td>
</tr>
<tr>
<td>GPU</td>
<td>67.6</td>
</tr>
</tbody>
</table>
</div>
<h3 id="computing-derivatives-of-expectations">Computing derivatives of expectations<a class="headerlink" href="#computing-derivatives-of-expectations" title="Permanent link">造</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># using jac_ediff2 that was computed in memory instead of loading the result which seems to loose accuracy</span>
<span class="n">sol_admc1_t</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./ADDiscreteMC1_t&quot;</span><span class="p">)</span>
<span class="n">sol_admc1_fem</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./ADDiscreteMC1_fem&quot;</span><span class="p">)</span>
<span class="n">jac_t</span> <span class="o">=</span> <span class="n">sol_admc1_t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">jac</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
<span class="n">obj_t</span> <span class="o">=</span> <span class="n">sol_admc1_t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">objective</span>
<span class="n">jac_fem</span> <span class="o">=</span> <span class="n">sol_admc1_fem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">jac</span>
<span class="n">semispan</span> <span class="o">=</span> <span class="mf">25.9</span> <span class="c1"># for normalisation</span>
<span class="n">mass</span> <span class="o">=</span> <span class="mf">55615.12</span>  <span class="c1"># Kg, see BUG modelgeneration.org</span>
<span class="n">normalisation</span> <span class="o">=</span> <span class="n">mass</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">9.81</span>   
<span class="n">mc1_jacpaths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mf">4e2</span><span class="p">,</span> <span class="mf">8e2</span><span class="p">,</span> <span class="mf">4e3</span><span class="p">]</span> <span class="c1">#[8, 80, 4e2, 8e2, 4e3, 8e3, 2e4]</span>
<span class="n">mc1_eps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-1</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">]</span>
<span class="n">sol_admc1_e</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">sol_admc1_j</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">mc1_jac</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">mc1_jobj</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">mc1_eobj</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>  
<span class="n">mc1_ejac</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">jac_pdiff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">obj_pdiff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>  
<span class="n">jac_ediff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">jac_ediff2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">mc1_ejac2</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;./ADDiscreteMC1_te/jac_e.npy&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mc1_jacpaths</span><span class="p">):</span>
    <span class="n">sol_admc1_j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./ADDiscreteMC1_tjac</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">mc1_jobj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol_admc1_j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">objective</span><span class="p">)</span>
    <span class="n">mc1_jac</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol_admc1_j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">jac</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mc1_jacpaths</span><span class="p">):</span> <span class="c1"># needing to read all to take last one</span>
    <span class="n">obj_pdiff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mc1_jobj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mc1_jobj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span>
                     <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mc1_jobj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">jac_pdiff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mc1_jac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mc1_jac</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span>
                     <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mc1_jac</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ei</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mc1_eps</span><span class="p">):</span>
    <span class="n">sol_admc1_e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./ADDiscreteMC1_te</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">mc1_eobj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol_admc1_e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">objective</span><span class="p">)</span>
    <span class="n">mc1_ejac</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mc1_eobj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">obj_t</span><span class="p">)</span> <span class="o">/</span> <span class="n">ei</span><span class="p">)</span>
    <span class="n">jac_ediff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mc1_ejac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">jac_t</span><span class="p">)</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">jac_t</span><span class="p">))</span>
    <span class="n">jac_ediff2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mc1_ejac2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">jac_t</span><span class="p">)</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">jac_t</span><span class="p">))</span>
</code></pre></div>
<p>Now we set out to calculate the derivatives of the expectations
previously computed concurrently in Sec. <script type="math/tex; mode=display">BROKEN LINK: Montecarlo
analysis for UQ</script>. While the Montecarlo paths are independent of each
other and could therefore be run on different machines, having to do AD
on the output statistics -gathered via collective operations-, forces
the entire chain of operations to be within a single program. This makes
for an interesting and challenging problem to propagate gradients
through concurrent operations. A linear parameter $\alpha$ is introduced
such that the follower forces and torsional moments in Eq.
<code>\eqref{eq:normal_loading}</code> are
$\mu = 10^4 (\frac{\alpha - 1.5}{4-1.5} + 1.5\times\frac{\alpha - 1}{5-1}) $.
The selected output is the expectation of a 3-component vector,
$\bm{r}(\alpha)$ of the wing-tip positions at $\alpha = 4.5$. Fig.
<a href="#fig:jac_ediff">3</a> shows a comparison between the derivative
$\partial_{\alpha} \bm{r}^a = \partial \mathbb{E}[\bm{r}] / \partial \alpha $
using AD, and finite differences
$ \partial_{\alpha} \bm{r}^{f}= (\bm{r}(\alpha + \epsilon) - \bm{r}(\alpha))/\epsilon  $.
The relative error is calculated as
$||\partial_{\alpha} \bm{r}^{a} - \partial_{\alpha} \bm{r}^{f} || / ||\partial_{\alpha} \bm{r}^{a} ||  $,
using the $l_2 $ norm.</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="n">plot_jacediff</span><span class="p">)(</span><span class="n">mc1_eps</span><span class="p">,</span> <span class="n">jac_ediff</span><span class="p">)</span>
<span class="n">figname</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">plot_jacediff2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mc1_eps</span><span class="p">,</span> <span class="n">mc1_ejac2</span><span class="p">)</span>
<span class="n">figname</span>
</code></pre></div>
<p><img alt="Relative error for the derivative of expectations of the wing-tip
position with respect to $\alpha $" src="../figs/jac_ediff.png" title="jac_ediff" /></p>
<p>Another convergence metric to investigate is the number of paths in the
Montecarlo analysis. We take $[8, 80, 400, 800]$ paths and using the
same error metric as for the finite differences calculate its evolution
taking 4000 paths as the reference. The plot in <a href="#fig:jac_pdiff">4</a>
shows that the convergence of the value function (expectation of the
wing tip position) is faster than its derivative with respect to the
loading parameter $\alpha $. This may or not be an issue in optimization
studies with expectations as sometimes high accuracy in the gradients is
not that important as having a good direction.</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="n">plot_jacpdiff</span><span class="p">)(</span><span class="n">mc1_jacpaths</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">obj_pdiff</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">jac_pdiff</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">figname</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">plot_jacpdiff2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mc1_jacpaths</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">obj_pdiff</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">jac_pdiff</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">figname</span>
</code></pre></div>
<p><img alt="Convergence with number of paths of expected wing-tip position and its
Jacobian with respect to $\alpha $." src="../figs/jac_pdiff.png" title="jac_pdiff" /></p>
<p>While changing the input loading is good for verification studies, more
realistic examples are solved in Fig. <a href="#fig:jac_Ma4">5</a> where the
sensitivity of the expectations of wing root loads are calculated with
respect to the FE matrices and eigenvectors (only indexes corresponding
to the right wing nodes are shown in the heat map as the other are 0
because the model is clamped). The derivatives in Fig.
<a href="#fig:jac_pdiff">4</a> were calculated in forward mode, but the condensed
FE matrices of the BUG model contain 99 condensed nodes, each with 6
components, so $(99 \times 6)^2 = 352836 $ entries, to what all the
components in eigenvectors are also added, therefore only backward mode
AD is possible in this case. The sensitivity of the loads with respect
to the mass matrix increase towards the nodes at tip of the wing, which
makes sense if we think a unit mass at the tip will produce much larger
loads than the same unit mass close to the root where the aircraft is
clamped.<br />
The wall-time to calculate the gradient of wing-root loads expectations
with respect to the mass matrix using 800 paths in the Montecarlo
analysis was 48.0 and 297.9 in the GPU and CPU respectively.</p>
<div class="highlight"><pre><span></span><code><span class="n">m_start</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="mi">12</span>
<span class="n">m_end</span> <span class="o">=</span> <span class="n">m_start</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="mi">23</span><span class="c1">#6*35 #m_start + 136 # 6*35</span>
<span class="n">f_index</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_index</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">jump</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">shift</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">Ma_plot</span> <span class="o">=</span> <span class="n">jac_fem</span><span class="p">[</span><span class="s1">&#39;Ma&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">f_index</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">xindex</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m_start</span><span class="o">+</span><span class="n">n_index</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">m_end</span><span class="o">+</span><span class="n">n_index</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">jump</span><span class="p">)</span>
<span class="n">yindex</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m_start</span><span class="o">+</span><span class="n">n_index</span><span class="p">,</span> <span class="n">m_end</span><span class="o">+</span><span class="n">n_index</span><span class="p">,</span> <span class="n">jump</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="n">plot_jacfemold</span><span class="p">)(</span> <span class="n">Ma_plot</span> <span class="o">/</span><span class="n">normalisation</span><span class="p">,</span>
                                              <span class="n">xindex</span><span class="p">,</span>
                                              <span class="n">yindex</span><span class="p">,</span>
                                              <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;i-components&quot;</span><span class="p">,</span>
                                              <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;j-components&quot;</span>
                                             <span class="p">)</span>
<span class="n">figname</span>
</code></pre></div>
<p><img alt="Weight-normalized Jacobian of wing-root bending moment with respect to
Mass matrix right-wing subcomponents" src="../figs/jac_Ma4.png" title="jac_Ma4" /></p>
<div class="highlight"><pre><span></span><code><span class="n">m_start</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="mi">12</span>
<span class="n">m_end</span> <span class="o">=</span> <span class="n">m_start</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="mi">23</span><span class="c1">#6*35 #m_start + 136 # 6*35</span>
<span class="n">f_index</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_index</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">jump</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">shift</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">Ma_plot</span> <span class="o">=</span> <span class="n">jac_fem</span><span class="p">[</span><span class="s1">&#39;Ma&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">f_index</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">xindex</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m_start</span><span class="o">+</span><span class="n">n_index</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">m_end</span><span class="o">+</span><span class="n">n_index</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">jump</span><span class="p">)</span>
<span class="n">yindex</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m_start</span><span class="o">+</span><span class="n">n_index</span><span class="p">,</span> <span class="n">m_end</span><span class="o">+</span><span class="n">n_index</span><span class="p">,</span> <span class="n">jump</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="n">plot_jacfemold</span><span class="p">)(</span> <span class="n">Ma_plot</span> <span class="o">/</span><span class="n">normalisation</span><span class="p">,</span>
                                              <span class="n">xindex</span><span class="p">,</span>
                                              <span class="n">yindex</span><span class="p">,</span>
                                              <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;i-components&quot;</span><span class="p">,</span>
                                              <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;j-components&quot;</span>
                                             <span class="p">)</span>
<span class="n">figname</span>
</code></pre></div>
<p><img alt="Weight-normalized Jacobian of wing-root shear force with respect to
Mass matrix right-wing subcomponents2" src="../figs/jac_Ma42.png" title="jac_Ma42" /></p>
<h3 id="steady-manoeuvre-loads">Steady manoeuvre loads<a class="headerlink" href="#steady-manoeuvre-loads" title="Permanent link">造</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">sol_manoeuvre</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./manoeuvre1Shard&quot;</span><span class="p">)</span>
<span class="n">config_manoeuvre</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;./manoeuvre1Shard/config.yaml&quot;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">aoa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">ti</span> <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>
<span class="n">ra</span> <span class="o">=</span> <span class="n">sol_manoeuvre</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">staticsystem_s1</span><span class="o">.</span><span class="n">ra</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">component</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">node</span> <span class="o">=</span> <span class="mi">35</span>
<span class="n">ra_tip0</span> <span class="o">=</span> <span class="n">config_manoeuvre</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="n">ra_tip</span> <span class="o">=</span> <span class="n">ra</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">node</span><span class="p">]</span>
<span class="n">ua</span> <span class="o">=</span> <span class="n">ra_tip</span> <span class="o">-</span> <span class="n">ra_tip0</span>
<span class="n">semispan</span> <span class="o">=</span> <span class="n">ra_tip0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
<span class="n">uatip</span> <span class="o">=</span> <span class="n">ua</span><span class="p">[:,</span> <span class="n">component</span><span class="p">]</span> <span class="o">/</span> <span class="n">semispan</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">uatip_lin</span> <span class="o">=</span> <span class="p">[</span><span class="n">uatip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ti</span> <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>
</code></pre></div>
<p>We extend the previous analysis to a static aeroelastic case for varying
angles of attack that represent a manoeuvre scenario. We test the
parallelisation by varying the flow density ($\pm 20 \%$ of the
reference density 0.41 Kg/ m$^3$) as well and the flow velocity
($\pm 20 \%$ of the reference velocity 209.6 m/s). 16 different points
for both density and velocity make a total number of 256 simulations.
The Mach number is fixed at 0.7 corresponding to the reference flow
condition values. Fig. <a href="fig:BUG_manoeuvre3D">fig:BUG_manoeuvre3D</a>
illustrates the 3D equilibrium of the airframe at the reference flight
conditions.</p>
<p><a href="../figs_ext/monoeuvre3D.pdf">file:figs_ext/monoeuvre3D.pdf</a></p>
<p>In Fig. <a href="#fig:Manoeuvretip">7</a> the tip of the wing in Fig.
<a href="fig:BUG_manoeuvre3D">fig:BUG_manoeuvre3D</a> is plotted for various
angles-of-attach (AoA), normalized with the wing semi-span ($b= 25.9$)
m. Comparison against linear analysis is carried out and the tip
position in the nonlinear analysis falls down the linear counter part as
expected. The flow velocities and density are selected at the maximum of
the load envelope at 251.6 m/s and 0.5 kg/m$^3$ respectively. This
highlights the potential need for geometrically nonlinear aeroelastic
tools in future aircraft configurations under high loading scenarios.</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="n">plot_manoeuvretip</span><span class="p">)(</span><span class="n">aoa</span><span class="p">,</span> <span class="n">uatip</span><span class="p">,</span> <span class="n">uatip_lin</span><span class="p">)</span>
<span class="n">figname</span>
</code></pre></div>
<p><img alt="Wing tip position for increasing angle of
attack" src="../figs/Manoeuvretip.png" title="Manoeuvretip" /></p>
<p>Table <a href="#table:times_manoeuvre">3</a> shows the computational times to run
these simulations, which shows near no overhead in adding a few hundred
of static calculations when moving from the single load case in the CPU
to the GPU (nearly 8 seconds to 14 seconds, which amounts for 6 seconds
cost when adding an extra 255 cases).</p>
<div id="table:times_manoeuvre">
<table>
<thead>
<tr>
<th>Device</th>
<th>Time <script type="math/tex; mode=display">sec.</script>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>CPU (single)</td>
<td>7.71  256 = 1973.8</td>
</tr>
<tr>
<td>CPU (parallel)</td>
<td>52.8</td>
</tr>
<tr>
<td>GPU</td>
<td>14.4</td>
</tr>
</tbody>
</table>
</div>
<h3 id="dynamic-loads-at-large-scale">Dynamic loads at large scale<a class="headerlink" href="#dynamic-loads-at-large-scale" title="Permanent link">造</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">sol_gust1shard</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./gust1_eaoShard&quot;</span><span class="p">)</span>
<span class="n">node</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">sol_gust1shard</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shards_s1</span><span class="o">.</span><span class="n">points</span>
<span class="n">gust_wn</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1"># 11 intensity points</span>
<span class="n">gust_w</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:</span><span class="n">gust_wn</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">gust_l</span> <span class="o">=</span> <span class="n">points</span><span class="p">[::</span><span class="n">gust_wn</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">gust_ln</span> <span class="o">=</span> <span class="mi">11</span>  <span class="c1"># 11 gust lenght points</span>
<span class="n">mass</span> <span class="o">=</span> <span class="mf">55615.12</span>  <span class="c1"># Kg, see BUG modelgeneration.org</span>
<span class="n">semispan</span> <span class="o">=</span> <span class="mf">25.9</span>
<span class="n">normalisation_force</span> <span class="o">=</span> <span class="n">mass</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">9.81</span>
<span class="n">normalisation_moment</span> <span class="o">=</span> <span class="n">normalisation_force</span> <span class="o">*</span> <span class="n">semispan</span>
<span class="n">x2max</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sol_gust1shard</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_s1</span><span class="o">.</span><span class="n">X2</span><span class="p">[:,:,</span> <span class="p">:,</span> <span class="n">node</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># points,6</span>
<span class="c1">#x2min = jnp.min(sol_gust1shard.data.dynamicsystem_s1.X2[:,:, :, node], axis=1)</span>
<span class="n">x2max_mesh</span> <span class="o">=</span> <span class="n">x2max</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">gust_ln</span><span class="p">,</span> <span class="n">gust_wn</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span> <span class="c1"># contour: wn is x, ln is y</span>
<span class="c1">#x2min_mesh = x2min.reshape((gust_ln, gust_wn,6))</span>
</code></pre></div>
<p>In this final example we perform a dynamic aeroelastic analysis to study
the response of the aircraft to multiple 1-cos gusts for varying length,
intensity and the density of the airflow. The mach number is kept
constant at 0.7. In the examples above the aircraft was clamped while
the aircraft is free here. A Runge-Kutta solver is employed to march in
time the equations with a time step of $10^{-3}$ s and the total number
of modes used was 100. Note the large size of the aeroelastic ODE
system: 2  100 nonlinear equations plus 5  100 linear equations for
the aerodynamic states with 5 poles, plus 4 equations for the quaternion
tracking the rigid-body motion, for a combined ODE system of 704
equations. In addition, a total of 512 gusts cases are run concurrently
for all possible combinations of 8 gust lengths between 50 and 200
meters, 8 gust intensities between 5 and 25 m/s, and 8 airflow densities
between 0.34 and 0.48 Kg/m$^3$. This means that
$512 \times 704 = 360448$ equations are being marched in time, in this
case for 2 seconds which is enough to capture peak loads. We have
verified the concurrent implementation by satisfactory comparing
single-point simulations to the same points within the parallel results.
Table <a href="#table:times_gust">4</a> contains the simulation times of the
calculation, which shows one order of magnitude increase in performance
when running in parallel in the CPU versus a complete single simulation
running sequentially, and another order of magnitude when moving from
the CPU to a modern GPU. This exemplifies the power of modern hardware
for scientific computation.</p>
<div id="table:times_gust">
<table>
<thead>
<tr>
<th>Device</th>
<th>Time <script type="math/tex; mode=display">sec.</script>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>CPU (single)</td>
<td>27.8  512 = 14233.6</td>
</tr>
<tr>
<td>CPU (parallel)</td>
<td>922.6</td>
</tr>
<tr>
<td>GPU</td>
<td>38.2</td>
</tr>
</tbody>
</table>
</div>
<p>In Fig. <a href="#fig:BUG_Gust3D">8</a> the 3D reconstructed flight shape of the
airframe is depicted for a gust of 150 m length, intensity of 20 m/s and
flow density of 0.41 Kg/m$^3$</p>
<p><img alt="Full aircraft Dynamic response to 1-cos gust
excitation" src="../figs_ext/Gust3D_3.png" title="BUG_Gust3D" /></p>
<p>Figs. <a href="#fig:GustShard_shear">9</a>, <a href="#fig:GustShard_torsion">10</a> and
<a href="#fig:GustShard_bending">11</a> show the load diagrams for the maximum
shear, torsion and out-of-pane bending at the wing root during the gust
encounter, normalized with the aircraft weight and wing semi-span. They
reflect the importance of running multiple of these simulations to
assess the critical loads: maximum loads occur at different gust lengths
of 65, 75, 115 m/s. This analysis would be extended to include various
mass cases, flying altitudes etc. in an industrial environment, and it
would be straight forward to extend our tools for this.</p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="n">plot_gustshard</span><span class="p">)(</span><span class="n">gust_w</span><span class="p">,</span> <span class="n">gust_l</span><span class="p">,</span> <span class="n">x2max_mesh</span> <span class="o">/</span> <span class="n">normalisation_force</span><span class="p">,</span>
                                             <span class="n">component</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">figname</span>
</code></pre></div>
<p><img alt="Normalized max. wing-root internal loading, shear
force" src="../figs/GustShard_shear.png" title="GustShard_shear" /></p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="n">plot_gustshard</span><span class="p">)(</span><span class="n">gust_w</span><span class="p">,</span> <span class="n">gust_l</span><span class="p">,</span> <span class="n">x2max_mesh</span> <span class="o">/</span> <span class="n">normalisation_moment</span><span class="p">,</span>
                                             <span class="n">component</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">figname</span>
</code></pre></div>
<p><img alt="Normalized max. wing-root internal loading, torsional
moment" src="../figs/GustShard_torsion.png" title="GustShard_torsion" /></p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="n">fig_out</span><span class="p">(</span><span class="n">name</span><span class="p">)(</span><span class="n">plot_gustshard</span><span class="p">)(</span><span class="n">gust_w</span><span class="p">,</span> <span class="n">gust_l</span><span class="p">,</span> <span class="n">x2max_mesh</span> <span class="o">/</span> <span class="n">normalisation_moment</span><span class="p">,</span>
                                             <span class="n">component</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">figname</span>
</code></pre></div>
<p><img alt="Normalized max. wing-root internal loading, bending
moment" src="../figs/GustShard_bending.png" title="GustShard_bending" /></p>
<ol>
<li>
<p>Load envelope differentiation</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">feniax.intrinsic.objectives</span> <span class="k">as</span> <span class="nn">objectives</span>
<span class="n">sol_gust1forager</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./gustforager&quot;</span><span class="p">)</span>
<span class="n">load_jacs</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">if</span> <span class="n">load_jacs</span><span class="p">:</span>
    <span class="n">jac_rho</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;./gustforager_epsilonrho/jac_rho.npy&quot;</span><span class="p">)</span>
    <span class="n">jac_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;./gustforager_epsilonlength/jac_length.npy&quot;</span><span class="p">)</span>
    <span class="n">jac_intensity</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;./gustforager_epsilonintensity/jac_intensity.npy&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># this is not working proprerly with FD, loose of accuracy in saving the data??</span>
    <span class="n">sol_gust1forager_val</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./gustforager_validation&quot;</span><span class="p">)</span>
    <span class="n">sol_gust1forager_erho</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./gustforager_epsilonrho&quot;</span><span class="p">)</span>
    <span class="n">sol_gust1forager_elength</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./gustforager_epsilonlength&quot;</span><span class="p">)</span>
    <span class="n">sol_gust1forager_eintensity</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">IntrinsicReader</span><span class="p">(</span><span class="s2">&quot;./gustforager_epsilonintensity&quot;</span><span class="p">)</span>  
    <span class="n">node</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">t_range</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_s1</span><span class="o">.</span><span class="n">t</span><span class="p">))</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shards_s1</span><span class="o">.</span><span class="n">points</span>
    <span class="n">filtered_map</span> <span class="o">=</span> <span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">forager_shard2adgust</span><span class="o">.</span><span class="n">filtered_map</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">forager_shard2adgust</span><span class="o">.</span><span class="n">filtered_indexes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="n">jac_rho</span> <span class="o">=</span> <span class="p">(</span><span class="n">objectives</span><span class="o">.</span><span class="n">X2_MAX</span><span class="p">(</span><span class="n">sol_gust1forager_erho</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_s1</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span>
                                 <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">node</span><span class="p">]),</span>
                                 <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">components</span><span class="p">),</span>
                                 <span class="n">t_range</span><span class="p">)</span> <span class="o">-</span>
                 <span class="n">objectives</span><span class="o">.</span><span class="n">X2_MAX</span><span class="p">(</span><span class="c1">#sol_gust1forager.data.dynamicsystem_s1.X2[index],</span>
                                   <span class="n">sol_gust1forager_val</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_s1</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span>
                                   <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">node</span><span class="p">]),</span>
                                   <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">components</span><span class="p">),</span>
                                   <span class="n">t_range</span><span class="p">)</span>
                 <span class="p">)</span> <span class="o">/</span> <span class="n">epsilon</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="n">jac_length</span> <span class="o">=</span> <span class="p">(</span><span class="n">objectives</span><span class="o">.</span><span class="n">X2_MAX</span><span class="p">(</span><span class="n">sol_gust1forager_elength</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_s1</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span>
                                 <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">node</span><span class="p">]),</span>
                                 <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">components</span><span class="p">),</span>
                                 <span class="n">t_range</span><span class="p">)</span> <span class="o">-</span>
                 <span class="n">objectives</span><span class="o">.</span><span class="n">X2_MAX</span><span class="p">(</span><span class="c1">#sol_gust1forager.data.dynamicsystem_s1.X2[index],</span>
                     <span class="n">sol_gust1forager_val</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_s1</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span>
                                   <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">node</span><span class="p">]),</span>
                                   <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">components</span><span class="p">),</span>
                                   <span class="n">t_range</span><span class="p">)</span>
                 <span class="p">)</span> <span class="o">/</span> <span class="n">epsilon</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="n">jac_intensity</span> <span class="o">=</span> <span class="p">(</span><span class="n">objectives</span><span class="o">.</span><span class="n">X2_MAX</span><span class="p">(</span><span class="n">sol_gust1forager_eintensity</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_s1</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span>
                                       <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">node</span><span class="p">]),</span>
                                       <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">components</span><span class="p">),</span>
                                       <span class="n">t_range</span><span class="p">)</span> <span class="o">-</span>
                     <span class="n">objectives</span><span class="o">.</span><span class="n">X2_MAX</span><span class="p">(</span><span class="c1">#sol_gust1forager.data.dynamicsystem_s1.X2[index],</span>
                         <span class="n">sol_gust1forager_val</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_s1</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span>
                                       <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">node</span><span class="p">]),</span>
                                       <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">components</span><span class="p">),</span>
                                       <span class="n">t_range</span><span class="p">)</span>
                 <span class="p">)</span> <span class="o">/</span> <span class="n">epsilon</span>

<span class="n">jacdiff_rho</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_scatter0</span><span class="o">.</span><span class="n">jac</span><span class="p">[</span><span class="s1">&#39;rho_inf&#39;</span><span class="p">]</span> <span class="o">-</span>
               <span class="n">jac_rho</span><span class="p">)</span> <span class="o">/</span> <span class="n">jac_rho</span><span class="p">)</span>
<span class="n">jacdiff_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_scatter0</span><span class="o">.</span><span class="n">jac</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">-</span>
               <span class="n">jac_length</span><span class="p">)</span> <span class="o">/</span> <span class="n">jac_length</span><span class="p">)</span>
<span class="n">jacdiff_intensity</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_scatter0</span><span class="o">.</span><span class="n">jac</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span> <span class="o">-</span>
               <span class="n">jac_intensity</span><span class="p">)</span> <span class="o">/</span> <span class="n">jac_intensity</span><span class="p">)</span>

<span class="n">normalise</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">normalisation_force</span><span class="p">,</span> <span class="n">normalisation_moment</span><span class="p">,</span> <span class="n">normalisation_moment</span><span class="p">])</span>
<span class="n">jac_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_scatter0</span><span class="o">.</span><span class="n">objective</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">normalise</span><span class="p">,</span>
                <span class="n">rho</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_scatter0</span><span class="o">.</span><span class="n">jac</span><span class="p">[</span><span class="s1">&#39;rho_inf&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">normalise</span><span class="p">,</span>
                <span class="n">rho_fd</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">jac_rho</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalise</span><span class="p">,</span>
                <span class="n">rho_diff</span><span class="o">=</span><span class="n">jacdiff_rho</span><span class="p">,</span>
                <span class="n">Length</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_scatter0</span><span class="o">.</span><span class="n">jac</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">normalise</span><span class="p">,</span>
                <span class="n">Length_fd</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">jac_length</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalise</span><span class="p">,</span>
                <span class="n">Length_diff</span><span class="o">=</span><span class="n">jacdiff_length</span><span class="p">,</span> <span class="n">Intensity</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">sol_gust1forager</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dynamicsystem_scatter0</span><span class="o">.</span><span class="n">jac</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]),</span>
                <span class="n">Intensity_fd</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">jac_intensity</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalise</span><span class="p">,</span>
                <span class="n">Intensity_diff</span><span class="o">=</span><span class="n">jacdiff_intensity</span>
                <span class="p">)</span>
<span class="n">df_jac</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">jac_dict</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Shear&#39;</span><span class="p">,</span> <span class="s1">&#39;Torsion&#39;</span><span class="p">,</span> <span class="s1">&#39;Bending&#39;</span><span class="p">])</span>
<span class="c1">#df_jac = df_jac.rename()</span>
</code></pre></div>
<p>Since dynamic load envelopes have been constructed, the interest is
to be able to obtain derivatives at the critical points. In
opposition to the derivatives of expectations where all the
operations are needed in the construction of the computational
graph, here only a few of the most problematic cases are
automatically identifies and its derivatives computed. The metrics
being tracked are wing-root shear, torsion and out-of plane bending
moments. The parallelisation is set for two gust intensities, two
flow densities and 16 gust lengths to cover 1-cos gusts from 50 to
200 m/s with 10 m/s separation between points. Rather than a
realistic example, this is set to test the machinery of the forager
pattern and verify it can indeed discover critical load cases and
automatically compute gradients. The gradient of these critical
cases is also calculated with respect to the flow density, gust
length and intensity (thus they are not only the parameters for the
parallelisation but are also chosen to be the input variables of the
sensitivity analysis, though any other input such as FE matrices
could have been chosen). By looking at Figs.
<a href="#fig:GustShard_shear">9</a> - <a href="#fig:GustShard_bending">11</a>, we can
identify maximum loads at around 65, 75, 115 m/s gust lengths for
shear, torsion and bending. Of the 64 cases analyzed, the forager
step picked those with higher intensity and flow density as
expected, but only 2 gust lengths of 70 m/s for the shear and
torsion, and 110 m/s for the out-of-plane bending. The finer the
discretization in the input of the parallelization, the closer to
the actual maximum, but also the more computations that need to be
run. It is therefore a balance whose best compromise is to be found
on an actual optimization study. Once those peaks are found, the
algorithms triggers the sensitivity analysis, for which we have
shown a verification for the 70 m/s gust with maximum density and
intensity in Table <a href="#table:forager">5</a>. Finite differences are
computed with an $\epsilon = 10^{-4} $ and the absolute relative
difference with AD is shown as $ \Delta $ for each of the input
parameters ($ \partial  \rho_{\inf} $ for the flow density
derivative, $ \partial L $ for the gust length, and $ \partial w $
for the gust intensity). The computational wall-time for entire
forager loop (concurrent loads, filtering of critical cases and
sensitivities on them) was 60.1 and 359.5 seconds on the GPU and CPU
respectively.</p>
<div id="table:forager" markdown="1">
<table>
<thead>
<tr>
<th></th>
<th>objective</th>
<th>$ \partial  \rho_{\inf} $</th>
<th>$ \Delta $</th>
<th>$ \partial L $</th>
<th>$ \Delta $</th>
<th>$ \partial w $</th>
<th>$ \Delta $</th>
</tr>
</thead>
<tbody>
<tr>
<td>Shear</td>
<td>0.897</td>
<td>1.670</td>
<td>$ 1.6 \times 10^{-5} $</td>
<td>-0.0026</td>
<td>$ 4 \times 10^{-6} $</td>
<td>0.035</td>
<td>$ 1. \times 10^{-7} $</td>
</tr>
<tr>
<td>Torsion</td>
<td>0.025</td>
<td>-0.018</td>
<td>$ 4.2 \times 10^{-4} $</td>
<td>-0.0007</td>
<td>$ 3.9 \times 10^{-7} $</td>
<td>0.0018</td>
<td>$ 1.2 \times 10^{-6} $</td>
</tr>
<tr>
<td>Bending</td>
<td>0.300</td>
<td>0.329</td>
<td>$ 2.9 \times 10^{-5} $</td>
<td>0.00003</td>
<td>$ 1.7 \times 10^{-4} $</td>
<td>0.012</td>
<td>$ 9.2 \times 10^{-8} $</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><pre><span></span><code><span class="n">tabulate</span><span class="p">(</span><span class="n">df_jac</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">df_jac</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;orgtbl&#39;</span><span class="p">,</span>
         <span class="c1">#columns=[&quot;\(\rho_{\inf} \)&quot;, &quot;\(\rho_{\inf}\) FD&quot;, &quot;\(\Delta \)&quot;]</span>
         <span class="p">)</span>
</code></pre></div>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../industrialAC/main/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Full aircraft (clamped) gust verification">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Full aircraft (clamped) gust verification
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../theory_intrinsic/" class="md-footer__link md-footer__link--next" aria-label="Next: Intrinsic modal description">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Intrinsic modal description
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>